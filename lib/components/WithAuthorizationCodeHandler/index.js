var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _react=_interopRequireDefault(require("react"));var _propTypes=_interopRequireDefault(require("prop-types"));var _reactNative=require("react-native");var _recompose=require("recompose");var _lodash=_interopRequireDefault(require("lodash"));var _reactNativeModal=_interopRequireDefault(require("react-native-modal"));var _utils=require("../../utils");var _WebView=_interopRequireDefault(require("../WebView"));var _jsxFileName="/Users/lutrong/GitSource/react-native-oidc-auth-code/src/components/WithAuthorizationCodeHandler/index.js";var withAuthorizationCodeHandler=function withAuthorizationCodeHandler(WrappedComponent){var hocComponent=function hocComponent(_ref){var baseProps=_ref.baseProps,props=(0,_objectWithoutProperties2.default)(_ref,["baseProps"]);return _react.default.createElement(_reactNative.View,{style:{flex:1},__source:{fileName:_jsxFileName,lineNumber:13}},_react.default.createElement(WrappedComponent,(0,_extends2.default)({},baseProps,{openUrl:props.openUrl,__source:{fileName:_jsxFileName,lineNumber:14}})),_react.default.createElement(_reactNativeModal.default,{isVisible:props.isVisible,style:{margin:0},__source:{fileName:_jsxFileName,lineNumber:15}},_react.default.createElement(_WebView.default,{url:props.url,onNavigationStateChange:props.onNavigationStateChange,onClosePress:function onClosePress(){return props.setVisible(false);},__source:{fileName:_jsxFileName,lineNumber:16}})));};hocComponent.displayName="withAuthorizationCodeHandler("+WrappedComponent.displayName+")";hocComponent.propTypes={openUrl:_propTypes.default.func,isVisible:_propTypes.default.bool,url:_propTypes.default.string,onNavigationStateChange:_propTypes.default.func,setVisible:_propTypes.default.func,baseProps:_propTypes.default.object};return hocComponent;};var _default=(0,_recompose.compose)((0,_recompose.withProps)(function(props){return{baseProps:props,getCode:_utils.getCode};}),(0,_recompose.withState)('isVisible','setVisible',false),(0,_recompose.withState)('url','setUrl',undefined),(0,_recompose.withState)('callback','setCallback',undefined),(0,_recompose.withState)('redirectUrl','setRedirectUrl',undefined),(0,_recompose.withHandlers)({openUrl:function openUrl(_ref2){var setVisible=_ref2.setVisible,setUrl=_ref2.setUrl,setCallback=_ref2.setCallback,setRedirectUrl=_ref2.setRedirectUrl;return function(url,redirectUrl,onSuccess){setUrl(url);setRedirectUrl(redirectUrl);setCallback({onSuccess:onSuccess});setVisible(true);};},onNavigationStateChange:function onNavigationStateChange(_ref3){var callback=_ref3.callback,setVisible=_ref3.setVisible,getCode=_ref3.getCode,redirectUrl=_ref3.redirectUrl;return function(webState){var url=webState.url;if(url.startsWith(redirectUrl)){var code=getCode(url);if(_lodash.default.isFunction(callback.onSuccess)){setVisible(false);callback.onSuccess(code);}}};}}),withAuthorizationCodeHandler);exports.default=_default;